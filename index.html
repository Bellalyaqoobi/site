<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø³Ù†Ù¾ Ø§ÙØºØ§Ù†Ø³ØªØ§Ù† - ØªØ§Ú©Ø³ÛŒ Ø§ÛŒÙ†ØªØ±Ù†ØªÛŒ Ú©Ø§Ø¨Ù„</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #00c569;
            --primary-dark: #00a858;
            --secondary: #4a4a4a;
            --light: #f8f9fa;
            --dark: #333;
            --gray: #6c757d;
            --border: #e0e0e0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --radius: 12px;
            --afghan-red: #d32011;
            --afghan-black: #000000;
            --afghan-green: #00c569;
        }

        body {
            background-color: #f5f5f5;
            color: var(--dark);
            line-height: 1.6;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØµÙØ­Ù‡ Ø®ÙˆØ´Ø¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ */
        .welcome-page {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--afghan-green) 0%, var(--afghan-black) 50%, var(--afghan-red) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            padding: 20px;
        }

        .welcome-logo {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .welcome-title {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .welcome-btn {
            background: white;
            color: var(--afghan-green);
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: var(--shadow);
        }

        .welcome-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‡Ø¯Ø± */
        header {
            background: white;
            box-shadow: var(--shadow);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--afghan-green);
        }

        .nav-links {
            display: flex;
            gap: 25px;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--afghan-green);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--afghan-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            margin-top: 20px;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù†Ù‚Ø´Ù‡ */
        .map-container {
            position: relative;
            background: #e9ecef;
            border-radius: var(--radius);
            overflow: hidden;
            height: 600px;
            box-shadow: var(--shadow);
        }

        .kabul-map {
            width: 100%;
            height: 100%;
            background: #a8d5ba;
            position: relative;
        }

        .street {
            position: absolute;
            background: #6c757d;
        }

        .main-street {
            background: #495057;
        }

        .location-marker {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--afghan-red);
            border-radius: 50%;
            cursor: pointer;
            transform: translate(-50%, -50%);
        }

        .location-marker::after {
            content: attr(data-name);
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .location-marker:hover::after {
            opacity: 1;
        }

        .route-line {
            position: absolute;
            height: 4px;
            background: var(--afghan-green);
            transform-origin: 0 0;
            z-index: 5;
        }

        .car-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #2196f3;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .car-marker::after {
            content: "ğŸš—";
            position: absolute;
            top: -5px;
            left: -5px;
            font-size: 16px;
            transform: rotate(45deg);
        }

        /* Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ù†Ù‚Ø´Ù‡ */
        .map-controls {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 20;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .map-control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: none;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            color: var(--dark);
            transition: all 0.3s;
        }

        .map-control-btn:hover {
            background: var(--afghan-green);
            color: white;
        }

        .map-legend {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: white;
            padding: 10px 15px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            font-size: 12px;
            z-index: 20;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .legend-color.pickup {
            background: var(--afghan-green);
        }

        .legend-color.destination {
            background: var(--afghan-red);
        }

        .legend-color.driver {
            background: #2196f3;
        }

        .legend-color.route {
            background: var(--afghan-green);
            width: 20px;
            height: 4px;
            border-radius: 2px;
        }

        .current-location-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #2196f3;
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 15;
            cursor: pointer;
        }

        .current-location-marker::after {
            content: "ğŸ“";
            position: absolute;
            top: -10px;
            left: -5px;
            font-size: 16px;
        }

        .selected-pickup {
            position: absolute;
            width: 16px;
            height: 16px;
            background: var(--afghan-green);
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 15;
        }

        .selected-destination {
            position: absolute;
            width: 16px;
            height: 16px;
            background: var(--afghan-red);
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 15;
        }

        .map-instructions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 20px;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: var(--shadow);
            z-index: 10;
            max-width: 300px;
            display: none;
        }

        .map-instructions.active {
            display: block;
        }

        /* Ù¾Ù†Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø³ÙØ± */
        .ride-panel {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            height: fit-content;
        }

        .ride-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .ride-option {
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .ride-option.active {
            border-color: var(--afghan-green);
            background: rgba(0, 197, 105, 0.05);
        }

        .ride-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .ride-name {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .ride-price {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: border 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--afghan-green);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn-primary {
            background: var(--afghan-green);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--dark);
        }

        .btn-outline:hover {
            background: var(--light);
        }

        .trip-calculator {
            background: var(--light);
            border-radius: var(--radius);
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .trip-calculator.active {
            display: block;
        }

        .calculator-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .calculator-total {
            border-top: 1px solid var(--border);
            padding-top: 10px;
            margin-top: 10px;
            font-weight: bold;
            font-size: 1.1rem;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø¯Ø§Ù„ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .modal-body {
            padding: 20px;
        }

        /* Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: var(--radius);
            background: white;
            box-shadow: var(--shadow);
            z-index: 1100;
            display: none;
            max-width: 350px;
        }

        .notification.success {
            border-left: 4px solid var(--afghan-green);
        }

        .notification.error {
            border-left: 4px solid var(--afghan-red);
        }

        .notification.warning {
            border-left: 4px solid orange;
        }

        .driver-notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 15px;
            z-index: 1000;
            max-width: 300px;
            display: none;
        }

        .driver-notification.active {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .notification-title {
            font-weight: bold;
            color: var(--dark);
        }

        .notification-close {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: var(--gray);
        }

        .notification-body {
            font-size: 14px;
            color: var(--dark);
        }

        .notification-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .real-time-updates {
            position: absolute;
            top: 15px;
            right: 15px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 10px 15px;
            z-index: 20;
            font-size: 12px;
            display: none;
        }

        .real-time-updates.active {
            display: block;
        }

        .update-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }

        .update-item:last-child {
            margin-bottom: 0;
        }

        .update-icon {
            color: var(--afghan-green);
            font-size: 14px;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ÙÙˆØªØ± */
        footer {
            background: var(--dark);
            color: white;
            padding: 40px 0 20px;
            margin-top: 50px;
        }

        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
        }

        .footer-section h3 {
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 10px;
        }

        .footer-links a {
            color: #ccc;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: white;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            margin-top: 30px;
            border-top: 1px solid #444;
            color: #ccc;
            font-size: 0.9rem;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .footer-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .nav-links {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- ØµÙØ­Ù‡ Ø®ÙˆØ´Ø¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ -->
    <div class="welcome-page" id="welcome-page">
        <div class="welcome-logo">
            <i class="fas fa-car"></i>
        </div>
        <h1 class="welcome-title">Ø§Ø³Ù†Ù¾ Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†</h1>
        <p class="welcome-subtitle">Ø§ÙˆÙ„ÛŒÙ† Ùˆ Ø¨Ø²Ø±Ú¯ØªØ±ÛŒÙ† Ø³Ø±ÙˆÛŒØ³ ØªØ§Ú©Ø³ÛŒ Ø§ÛŒÙ†ØªØ±Ù†ØªÛŒ Ø¯Ø± Ú©Ø§Ø¨Ù„</p>
        <button class="welcome-btn" id="start-app-btn">Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯</button>
    </div>

    <!-- Ù‡Ø¯Ø± -->
    <header style="display: none;" id="main-header">
        <div class="header-container">
            <div class="logo">
                <i class="fas fa-car"></i>
                <span>Ø§Ø³Ù†Ù¾ Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†</span>
            </div>
            <nav class="nav-links">
                <a href="#" class="nav-link active">Ø®Ø§Ù†Ù‡</a>
                <a href="#" class="nav-link">Ø³ÙØ±Ù‡Ø§ÛŒ Ù…Ù†</a>
                <a href="#" class="nav-link">Ø®Ø¯Ù…Ø§Øª</a>
                <a href="#" class="nav-link">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</a>
                <a href="#" class="nav-link">ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§</a>
            </nav>
            <div class="user-menu">
                <div class="user-avatar" id="user-avatar">Ù…</div>
            </div>
        </div>
    </header>

    <!-- ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ -->
    <div class="container" style="display: none;" id="main-container">
        <div class="page active" id="home-page">
            <div class="main-content">
                <!-- Ù†Ù‚Ø´Ù‡ Ú©Ø§Ø¨Ù„ -->
                <div class="map-container">
                    <div class="kabul-map" id="kabulMap">
                        <!-- Ù†Ù‚Ø´Ù‡ ØªØ¹Ø§Ù…Ù„ÛŒ -->
                        <div class="map-instructions" id="mapInstructions">
                            <i class="fas fa-mouse-pointer"></i>
                            <p>Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø¨Ø¯Ø§ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</p>
                            <p>Ø³Ù¾Ø³ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ù‚ØµØ¯ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</p>
                        </div>
                    </div>
                    
                    <!-- Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ù†Ù‚Ø´Ù‡ -->
                    <div class="map-controls">
                        <button class="map-control-btn" id="locateMeBtn" title="Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ù…Ù†">
                            <i class="fas fa-location-arrow"></i>
                        </button>
                        <button class="map-control-btn" id="resetMapBtn" title="Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ù†Ù‚Ø´Ù‡">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button class="map-control-btn" id="zoomInBtn" title="Ø¨Ø²Ø±Ú¯Ù†Ù…Ø§ÛŒÛŒ">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="map-control-btn" id="zoomOutBtn" title="Ú©ÙˆÚ†Ú©Ù†Ù…Ø§ÛŒÛŒ">
                            <i class="fas fa-minus"></i>
                        </button>
                    </div>
                    
                    <!-- Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù†Ù‚Ø´Ù‡ -->
                    <div class="map-legend">
                        <div class="legend-item">
                            <div class="legend-color pickup"></div>
                            <span>Ù…Ø¨Ø¯Ø§</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color destination"></div>
                            <span>Ù…Ù‚ØµØ¯</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color driver"></div>
                            <span>Ø±Ø§Ù†Ù†Ø¯Ù‡</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color route"></div>
                            <span>Ù…Ø³ÛŒØ±</span>
                        </div>
                    </div>
                    
                    <!-- Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒâ€ŒÙ‡Ø§ÛŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ -->
                    <div class="real-time-updates" id="realTimeUpdates">
                        <div class="update-item">
                            <i class="fas fa-car update-icon"></i>
                            <span>Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù† ÙØ¹Ø§Ù„: <span id="activeDriversCount">12</span></span>
                        </div>
                        <div class="update-item">
                            <i class="fas fa-bolt update-icon"></i>
                            <span>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø²Ù…Ø§Ù† Ø§Ù†ØªØ¸Ø§Ø±: <span id="avgWaitTime">4</span> Ø¯Ù‚ÛŒÙ‚Ù‡</span>
                        </div>
                    </div>
                </div>

                <!-- Ù¾Ù†Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø³ÙØ± -->
                <div class="ride-panel">
                    <h2 style="margin-bottom: 20px;">Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø³ÙØ±</h2>
                    
                    <div class="ride-options">
                        <div class="ride-option active" data-type="economy">
                            <div class="ride-icon">ğŸš—</div>
                            <div class="ride-name">Ø§Ú©ÙˆÙ†ÙˆÙ…ÛŒ</div>
                            <div class="ride-price">Ø§Ø±Ø²Ø§Ù†â€ŒØªØ±ÛŒÙ†</div>
                        </div>
                        <div class="ride-option" data-type="comfort">
                            <div class="ride-icon">ğŸš™</div>
                            <div class="ride-name">Ú©Ø§Ù…ÙÙˆØ±Øª</div>
                            <div class="ride-price">Ø±Ø§Ø­Øªâ€ŒØªØ±</div>
                        </div>
                        <div class="ride-option" data-type="bike">
                            <div class="ride-icon">ğŸï¸</div>
                            <div class="ride-name">Ù…ÙˆØªÙˆØ±</div>
                            <div class="ride-price">Ø³Ø±ÛŒØ¹â€ŒØªØ±ÛŒÙ†</div>
                        </div>
                    </div>
                    
                    <form id="rideForm">
                        <div class="form-group">
                            <label for="pickup">Ù…Ø¨Ø¯Ø§</label>
                            <input type="text" id="pickup" class="form-control" placeholder="Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ø´Ù…Ø§">
                        </div>
                        
                        <div class="form-group">
                            <label for="destination">Ù…Ù‚ØµØ¯</label>
                            <input type="text" id="destination" class="form-control" placeholder="Ù…Ù‚ØµØ¯ Ø³ÙØ±">
                        </div>
                        
                        <button type="submit" class="btn btn-primary" id="submitBtn">Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø³ÙØ±</button>
                    </form>
                    
                    <div class="trip-calculator" id="tripCalculator">
                        <div class="calculator-item">
                            <span>Ù…Ø³Ø§ÙØª:</span>
                            <span id="distanceValue">0 Ú©ÛŒÙ„ÙˆÙ…ØªØ±</span>
                        </div>
                        <div class="calculator-item">
                            <span>Ù‡Ø²ÛŒÙ†Ù‡ Ø³ÙØ±:</span>
                            <span id="priceValue">0 Ø§ÙØºØ§Ù†ÛŒ</span>
                        </div>
                        <div class="calculator-item calculator-total">
                            <span>Ù‚ÛŒÙ…Øª Ù†Ù‡Ø§ÛŒÛŒ:</span>
                            <span id="totalPrice">0 Ø§ÙØºØ§Ù†ÛŒ</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù…Ø¯Ø§Ù„ ÙˆØ±ÙˆØ¯/Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ÙˆØ±ÙˆØ¯ / Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</h2>
                <button class="modal-close" id="closeAuthModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="authForm">
                    <div class="form-group">
                        <label for="phone">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</label>
                        <input type="tel" id="phone" class="form-control" placeholder="07XX XXX XXXX" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
                        <input type="password" id="password" class="form-control" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" id="authSubmitBtn">ÙˆØ±ÙˆØ¯</button>
                </form>
                
                <p style="text-align: center; margin-top: 15px;">
                    Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯ØŸ <a href="#" id="showRegister">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†ÛŒØ¯</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Ù…Ø¯Ø§Ù„ Ø±Ø§Ù†Ù†Ø¯Ù‡ -->
    <div class="modal" id="driverModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Ø±Ø§Ù†Ù†Ø¯Ù‡ Ù¾ÛŒØ¯Ø§ Ø´Ø¯</h2>
                <button class="modal-close" id="closeDriverModal">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                    <div class="user-avatar" id="driverAvatar" style="width: 60px; height: 60px; font-size: 1.5rem;">Ø±</div>
                    <div>
                        <h3 id="driverName">Ø±Ø¶Ø§ Ø§Ø­Ù…Ø¯ÛŒ</h3>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <span id="driverRating">Û´.Û·</span>
                            <i class="fas fa-star" style="color: gold;"></i>
                            <span id="driverTrips">(Û±ÛµÛ° Ø³ÙØ±)</span>
                        </div>
                    </div>
                </div>
                
                <div style="background: var(--light); padding: 15px; border-radius: var(--radius); margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Ù…Ø¯Ù„ Ù…Ø§Ø´ÛŒÙ†:</span>
                        <span id="carModel">ØªÙˆÛŒÙˆØªØ§ Ú©ÙˆØ±ÙˆÙ„Ø§</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Ø±Ù†Ú¯ Ù…Ø§Ø´ÛŒÙ†:</span>
                        <span id="carColor">Ø³ÙÛŒØ¯</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Ù¾Ù„Ø§Ú©:</span>
                        <span id="plateNumber">Ú©Ø§Ø¨Ù„ Û±Û²Û³Û´</span>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <div style="text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: bold;" id="eta">Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡</div>
                        <div style="font-size: 0.9rem; color: var(--gray);">Ø²Ù…Ø§Ù† Ø±Ø³ÛŒØ¯Ù†</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: bold;" id="distance">Û±.Û² Ú©ÛŒÙ„ÙˆÙ…ØªØ±</div>
                        <div style="font-size: 0.9rem; color: var(--gray);">ÙØ§ØµÙ„Ù‡</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 1.2rem; font-weight: bold;" id="price">Û±ÛµÛ° Ø§ÙØºØ§Ù†ÛŒ</div>
                        <div style="font-size: 0.9rem; color: var(--gray);">Ù‡Ø²ÛŒÙ†Ù‡</div>
                    </div>
                </div>
                
                <button class="btn btn-primary" id="confirmTripBtn">ØªØ£ÛŒÛŒØ¯ Ø³ÙØ±</button>
            </div>
        </div>
    </div>

    <!-- Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø±Ø§Ù†Ù†Ø¯Ù‡ -->
    <div class="driver-notification" id="driverNotification">
        <div class="notification-header">
            <div class="notification-title">Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø³ÙØ± Ø¬Ø¯ÛŒØ¯</div>
            <button class="notification-close" id="closeDriverNotification">&times;</button>
        </div>
        <div class="notification-body">
            <p>ÛŒÚ© Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø³ÙØ± Ø¬Ø¯ÛŒØ¯ Ø¯Ø± Ù†Ø²Ø¯ÛŒÚ©ÛŒ Ø´Ù…Ø§ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.</p>
            <p><strong>Ù…Ø¨Ø¯Ø§:</strong> <span id="notificationPickup">---</span></p>
            <p><strong>Ù…Ù‚ØµØ¯:</strong> <span id="notificationDestination">---</span></p>
            <p><strong>Ù‡Ø²ÛŒÙ†Ù‡:</strong> <span id="notificationPrice">---</span> Ø§ÙØºØ§Ù†ÛŒ</p>
        </div>
        <div class="notification-actions">
            <button class="btn btn-outline" id="rejectTripBtn">Ø±Ø¯ Ú©Ø±Ø¯Ù†</button>
            <button class="btn btn-primary" id="acceptTripBtn">Ù¾Ø°ÛŒØ±ÙØªÙ†</button>
        </div>
    </div>

    <!-- Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† -->
    <div class="notification" id="notification"></div>

    <!-- ÙÙˆØªØ± -->
    <footer style="display: none;" id="main-footer">
        <div class="footer-container">
            <div class="footer-section">
                <h3>Ø§Ø³Ù†Ù¾ Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†</h3>
                <p>Ø§ÙˆÙ„ÛŒÙ† Ùˆ Ø¨Ø²Ø±Ú¯ØªØ±ÛŒÙ† Ø³Ø±ÙˆÛŒØ³ ØªØ§Ú©Ø³ÛŒ Ø§ÛŒÙ†ØªØ±Ù†ØªÛŒ Ø¯Ø± Ú©Ø§Ø¨Ù„ Ú©Ù‡ Ø¨Ø§ Ú©ÛŒÙÛŒØª ØªØ±ÛŒÙ† Ø®Ø¯Ù…Ø§Øª Ø±Ø§ Ø¨Ù‡ Ø´Ù‡Ø±ÙˆÙ†Ø¯Ø§Ù† Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.</p>
            </div>
            
            <div class="footer-section">
                <h3>Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù…ÙÛŒØ¯</h3>
                <ul class="footer-links">
                    <li><a href="#">Ø®Ø§Ù†Ù‡</a></li>
                    <li><a href="#">Ø³ÙØ±Ù‡Ø§ÛŒ Ù…Ù†</a></li>
                    <li><a href="#">Ø®Ø¯Ù…Ø§Øª</a></li>
                    <li><a href="#">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</a></li>
                    <li><a href="#">ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Ø®Ø¯Ù…Ø§Øª</h3>
                <ul class="footer-links">
                    <li><a href="#">ØªØ§Ú©Ø³ÛŒ</a></li>
                    <li><a href="#">Ù…ÙˆØªÙˆØ±</a></li>
                    <li><a href="#">Ù¾ÛŒÚ©</a></li>
                    <li><a href="#">Ø³ÙØ± Ø¨ÛŒÙ† Ø´Ù‡Ø±ÛŒ</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§</h3>
                <ul class="footer-links">
                    <li><i class="fas fa-phone"></i> Û°Û·Û°Û° Û±Û²Û³ Û´ÛµÛ¶</li>
                    <li><i class="fas fa-envelope"></i> info@snapp.af</li>
                    <li><i class="fas fa-map-marker-alt"></i> Ú©Ø§Ø¨Ù„ØŒ Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†</li>
                </ul>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>Ú©Ù„ÛŒÙ‡ Ø­Ù‚ÙˆÙ‚ Ø§ÛŒÙ† Ø³Ø±ÙˆÛŒØ³ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª Â© Û²Û°Û²Û³ Ø§Ø³Ù†Ù¾ Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†</p>
        </div>
    </footer>

    <script>
        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Supabase
        const SUPABASE_URL = 'https://atichswkxinwqewtpvkr.supabase.co'; // Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯ Ø¨Ø§ URL Ù¾Ø±ÙˆÚ˜Ù‡ Ø´Ù…Ø§
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF0aWNoc3dreGlud3Fld3RwdmtyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1ODA2NjAsImV4cCI6MjA3NzE1NjY2MH0.UmJ7mQt4bmwIpvlrnp7J1TigQ8JqB09w_0OgcIVCtFA'; // Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯ Ø¨Ø§ Ú©Ù„ÛŒØ¯ anon Ø´Ù…Ø§
        
        // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù„Ø§ÛŒÙ†Øª Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ø§Ø·Ù‚ Ùˆ Ù†Ù‚Ø§Ø· Ù…Ù‡Ù… Ú©Ø§Ø¨Ù„
        const kabulLocations = [
            // Ù…Ù†Ø§Ø·Ù‚ Ù…Ø±Ú©Ø²ÛŒ
            { name: "Ù…ÛŒØ¯Ø§Ù† Ù‡ÙˆØ§ÛŒÛŒ", x: 65, y: 45 },
            { name: "Ú©Ø§Ø±ØªÙ‡ Ø³Ø®ÛŒ", x: 60, y: 60 },
            { name: "Ú©Ø§Ø±ØªÙ‡ Ú†Ù‡Ø§Ø±", x: 55, y: 50 },
            { name: "Ø´Ù‡Ø± Ù†Ùˆ", x: 50, y: 55 },
            { name: "Ø¯Ø´Øª Ø¨Ø±Ú†ÛŒ", x: 40, y: 65 },
            { name: "Ù‚Ù„Ø¹Ù‡ Ù†ÙˆØ±", x: 45, y: 40 },
            
            // Ø³ÙØ§Ø±ØªØ®Ø§Ù†Ù‡â€ŒÙ‡Ø§
            { name: "Ø³ÙØ§Ø±Øª Ø§Ù…Ø±ÛŒÚ©Ø§", x: 75, y: 25 },
            { name: "Ø³ÙØ§Ø±Øª Ø§ÛŒØ±Ø§Ù†", x: 65, y: 30 },
            { name: "Ø³ÙØ§Ø±Øª Ù¾Ø§Ú©Ø³ØªØ§Ù†", x: 60, y: 35 },
            
            // ÙˆØ²Ø§Ø±ØªØ®Ø§Ù†Ù‡â€ŒÙ‡Ø§
            { name: "Ø§Ø±Ú¯ Ø±ÛŒØ§Ø³Øª Ø¬Ù…Ù‡ÙˆØ±ÛŒ", x: 70, y: 20 },
            { name: "ÙˆØ²Ø§Ø±Øª Ø§Ù…ÙˆØ± Ø®Ø§Ø±Ø¬Ù‡", x: 65, y: 15 },
            
            // Ù…Ø±Ø§Ú©Ø² Ø®Ø±ÛŒØ¯
            { name: "Ø¨Ø§Ø²Ø§Ø± Ú©Ø§Ø¨Ù„", x: 50, y: 45 },
            { name: "Ø¨Ø§Ø²Ø§Ø± Ú©Ø§Ø±ØªÙ‡ Ø³Ø®ÛŒ", x: 58, y: 58 },
            
            // Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡â€ŒÙ‡Ø§
            { name: "Ù¾ÙˆÙ‡Ù†ØªÙˆÙ† Ú©Ø§Ø¨Ù„", x: 40, y: 35 },
            { name: "Ù¾ÙˆÙ‡Ù†ØªÙˆÙ† Ù¾ÙˆÙ„ÛŒ ØªØ®Ù†ÛŒÚ© Ú©Ø§Ø¨Ù„", x: 35, y: 40 },
            
            // Ø´ÙØ§Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§
            { name: "Ø´ÙØ§Ø®Ø§Ù†Ù‡ Ø¹Ù„ÛŒ Ø¢Ø¨Ø§Ø¯", x: 45, y: 50 },
            { name: "Ø´ÙØ§Ø®Ø§Ù†Ù‡ Ø¬Ù…Ù‡ÙˆØ±ÛŒØª", x: 65, y: 40 }
        ];

        // Ø®ÛŒØ§Ø¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø¨Ù„
        const kabulStreets = [
            { x: 10, y: 50, width: 80, height: 3, main: true },
            { x: 50, y: 10, width: 3, height: 80, main: true },
            { x: 20, y: 30, width: 60, height: 2, main: false },
            { x: 30, y: 20, width: 2, height: 60, main: false },
            { x: 40, y: 40, width: 40, height: 2, main: false },
            { x: 40, y: 40, width: 2, height: 40, main: false }
        ];

        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø³Ø±Ø§Ø³Ø±ÛŒ
        let currentUser = null;
        let selectedRideType = 'economy';
        let currentDistance = 0;
        let currentPrice = 0;
        let selectedPickup = null;
        let selectedDestination = null;
        let mapMode = 'pickup';
        let currentLocationMarker = null;
        let pickupMarker = null;
        let destinationMarker = null;
        let driverMarkers = [];
        let routeLine = null;
        let currentDriver = null;
        let currentTripId = null;

        // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù‚Ø´Ù‡ Ú©Ø§Ø¨Ù„ Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
        function createInteractiveMap() {
            const map = document.getElementById('kabulMap');
            if (!map) return;
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ø®ÛŒØ§Ø¨Ø§Ù†â€ŒÙ‡Ø§
            kabulStreets.forEach(street => {
                const streetElement = document.createElement('div');
                streetElement.className = 'street';
                if (street.main) {
                    streetElement.classList.add('main-street');
                }
                streetElement.style.left = `${street.x}%`;
                streetElement.style.top = `${street.y}%`;
                streetElement.style.width = `${street.width}%`;
                streetElement.style.height = `${street.height}%`;
                
                map.appendChild(streetElement);
            });
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù‚Ø§Ø· Ù…Ù‡Ù…
            kabulLocations.forEach(location => {
                const marker = document.createElement('div');
                marker.className = 'location-marker';
                marker.style.left = `${location.x}%`;
                marker.style.top = `${location.y}%`;
                marker.setAttribute('data-name', location.name);
                
                marker.addEventListener('click', () => {
                    handleLocationClick(location);
                });
                
                map.appendChild(marker);
            });
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÙˆÙ‚Ø¹ÛŒØª
            map.addEventListener('click', (e) => {
                if (e.target === map) {
                    const rect = map.getBoundingClientRect();
                    const x = ((e.clientX - rect.left) / rect.width) * 100;
                    const y = ((e.clientY - rect.top) / rect.height) * 100;
                    
                    handleMapClick(x, y);
                }
            });
            
            // Ù†Ù…Ø§ÛŒØ´ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù†Ù‚Ø´Ù‡
            const mapInstructions = document.getElementById('mapInstructions');
            if (mapInstructions) {
                mapInstructions.classList.add('active');
                
                // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø±Ø§Ù‡Ù†Ù…Ø§ Ù¾Ø³ Ø§Ø² 5 Ø«Ø§Ù†ÛŒÙ‡
                setTimeout(() => {
                    mapInstructions.classList.remove('active');
                }, 5000);
            }
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒâ€ŒÙ‡Ø§ÛŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ
            const realTimeUpdates = document.getElementById('realTimeUpdates');
            if (realTimeUpdates) {
                realTimeUpdates.classList.add('active');
            }
            
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù† ÙØ¹Ø§Ù„
            simulateActiveDrivers();
        }

        // Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡
        function handleMapClick(x, y) {
            if (mapMode === 'pickup') {
                // Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø¨Ø¯Ø§
                selectPickupLocation(x, y);
                mapMode = 'destination';
                showNotification('Ø­Ø§Ù„Ø§ Ù…Ù‚ØµØ¯ Ø³ÙØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'success');
            } else if (mapMode === 'destination') {
                // Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ù‚ØµØ¯
                selectDestinationLocation(x, y);
                mapMode = 'pickup';
            }
        }

        // Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ù…Ú©Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø´Ø®Øµ
        function handleLocationClick(location) {
            if (mapMode === 'pickup') {
                // Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø¨Ø¯Ø§
                selectPickupLocation(location.x, location.y, location.name);
                mapMode = 'destination';
                showNotification('Ø­Ø§Ù„Ø§ Ù…Ù‚ØµØ¯ Ø³ÙØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'success');
            } else if (mapMode === 'destination') {
                // Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ù‚ØµØ¯
                selectDestinationLocation(location.x, location.y, location.name);
                mapMode = 'pickup';
            }
        }

        // Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø¨Ø¯Ø§
        function selectPickupLocation(x, y, name = null) {
            const map = document.getElementById('kabulMap');
            if (!map) return;
            
            // Ø­Ø°Ù Ù†Ø´Ø§Ù†Ú¯Ø± Ù‚Ø¨Ù„ÛŒ
            if (pickupMarker) {
                pickupMarker.remove();
            }
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø§Ù†Ú¯Ø± Ø¬Ø¯ÛŒØ¯
            pickupMarker = document.createElement('div');
            pickupMarker.className = 'selected-pickup';
            pickupMarker.style.left = `${x}%`;
            pickupMarker.style.top = `${y}%`;
            map.appendChild(pickupMarker);
            
            // Ø°Ø®ÛŒØ±Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            selectedPickup = { x, y, name };
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙÛŒÙ„Ø¯ Ù…Ø¨Ø¯Ø§
            const pickupInput = document.getElementById('pickup');
            if (pickupInput) {
                pickupInput.value = name || `Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ (${x.toFixed(1)}%, ${y.toFixed(1)}%)`;
            }
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø³Ø§ÙØª Ùˆ Ù‚ÛŒÙ…Øª
            if (selectedDestination) {
                calculateDistanceAndPrice();
            }
        }

        // Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ù‚ØµØ¯
        function selectDestinationLocation(x, y, name = null) {
            const map = document.getElementById('kabulMap');
            if (!map) return;
            
            // Ø­Ø°Ù Ù†Ø´Ø§Ù†Ú¯Ø± Ù‚Ø¨Ù„ÛŒ
            if (destinationMarker) {
                destinationMarker.remove();
            }
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø§Ù†Ú¯Ø± Ø¬Ø¯ÛŒØ¯
            destinationMarker = document.createElement('div');
            destinationMarker.className = 'selected-destination';
            destinationMarker.style.left = `${x}%`;
            destinationMarker.style.top = `${y}%`;
            map.appendChild(destinationMarker);
            
            // Ø°Ø®ÛŒØ±Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            selectedDestination = { x, y, name };
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙÛŒÙ„Ø¯ Ù…Ù‚ØµØ¯
            const destinationInput = document.getElementById('destination');
            if (destinationInput) {
                destinationInput.value = name || `Ù…ÙˆÙ‚Ø¹ÛŒØª Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ (${x.toFixed(1)}%, ${y.toFixed(1)}%)`;
            }
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø³Ø§ÙØª Ùˆ Ù‚ÛŒÙ…Øª
            if (selectedPickup) {
                calculateDistanceAndPrice();
                
                // Ø±Ø³Ù… Ù…Ø³ÛŒØ±
                drawRoute(selectedPickup, selectedDestination);
            }
        }

        // Ø±Ø³Ù… Ù…Ø³ÛŒØ± Ø¨ÛŒÙ† Ø¯Ùˆ Ù†Ù‚Ø·Ù‡
        function drawRoute(start, end) {
            // Ø­Ø°Ù Ù…Ø³ÛŒØ± Ù‚Ø¨Ù„ÛŒ
            if (routeLine) {
                routeLine.remove();
            }
            
            const map = document.getElementById('kabulMap');
            if (!map) return;
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø®ØªØµØ§Øª Ùˆ Ø²Ø§ÙˆÛŒÙ‡ Ø®Ø·
            const dx = end.x - start.x;
            const dy = end.y - start.y;
            const length = Math.sqrt(dx * dx + dy * dy);
            const angle = Math.atan2(dy, dx) * 180 / Math.PI;
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ø®Ø· Ù…Ø³ÛŒØ±
            routeLine = document.createElement('div');
            routeLine.className = 'route-line';
            routeLine.style.left = `${start.x}%`;
            routeLine.style.top = `${start.y}%`;
            routeLine.style.width = `${length}%`;
            routeLine.style.transform = `rotate(${angle}deg)`;
            
            map.appendChild(routeLine);
        }

        // Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ú©Ø§Ø±Ø¨Ø±
        function locateUser() {
            if (!navigator.geolocation) {
                showNotification('Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯', 'error');
                return;
            }
            
            showNotification('Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§...', 'warning');
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    
                    // Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§ÛŒØ¯ Ø§Ø² API Ù†Ù‚Ø´Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ¨Ø¯ÛŒÙ„ Ù…Ø®ØªØµØ§Øª Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø± Ù†Ù‚Ø´Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯
                    // Ø¨Ø±Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡ØŒ Ø§Ø² Ù…ÙˆÙ‚Ø¹ÛŒØª ØªØµØ§Ø¯ÙÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
                    const randomX = Math.floor(Math.random() * 80) + 10;
                    const randomY = Math.floor(Math.random() * 80) + 10;
                    
                    userLocation = { x: randomX, y: randomY };
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆÙ‚Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø± Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡
                    showUserLocation(userLocation.x, userLocation.y);
                    
                    // Ù¾Ø± Ú©Ø±Ø¯Ù† Ø®ÙˆØ¯Ú©Ø§Ø± ÙÛŒÙ„Ø¯ Ù…Ø¨Ø¯Ø§
                    const pickupInput = document.getElementById('pickup');
                    if (pickupInput) {
                        pickupInput.value = 'Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ù…Ù†';
                    }
                    
                    // Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÙˆÙ‚Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù…Ø¨Ø¯Ø§
                    selectPickupLocation(userLocation.x, userLocation.y, 'Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ù…Ù†');
                    
                    showNotification('Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯', 'success');
                },
                (error) => {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª:', error);
                    let errorMessage = 'Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª';
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = 'Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§ Ø±Ø¯ Ø´Ø¯';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª';
                            break;
                        case error.TIMEOUT:
                            errorMessage = 'Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ø²Ù…Ø§Ù†â€ŒØ¨Ø± Ø´Ø¯';
                            break;
                    }
                    
                    showNotification(errorMessage, 'error');
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        }

        // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆÙ‚Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø± Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡
        function showUserLocation(x, y) {
            const map = document.getElementById('kabulMap');
            if (!map) return;
            
            // Ø­Ø°Ù Ù†Ø´Ø§Ù†Ú¯Ø± Ù‚Ø¨Ù„ÛŒ
            if (currentLocationMarker) {
                currentLocationMarker.remove();
            }
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø§Ù†Ú¯Ø± Ø¬Ø¯ÛŒØ¯
            currentLocationMarker = document.createElement('div');
            currentLocationMarker.className = 'current-location-marker';
            currentLocationMarker.style.left = `${x}%`;
            currentLocationMarker.style.top = `${y}%`;
            currentLocationMarker.title = 'Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ¹Ù„ÛŒ Ø´Ù…Ø§';
            map.appendChild(currentLocationMarker);
        }

        // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù† ÙØ¹Ø§Ù„
        function simulateActiveDrivers() {
            const map = document.getElementById('kabulMap');
            if (!map) return;
            
            // Ø­Ø°Ù Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù† Ù‚Ø¨Ù„ÛŒ
            driverMarkers.forEach(marker => marker.remove());
            driverMarkers = [];
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù† ÙØ¹Ø§Ù„
            const activeDriversCount = Math.floor(Math.random() * 10) + 5; // 5 ØªØ§ 15 Ø±Ø§Ù†Ù†Ø¯Ù‡
            
            for (let i = 0; i < activeDriversCount; i++) {
                const randomX = Math.floor(Math.random() * 80) + 10;
                const randomY = Math.floor(Math.random() * 80) + 10;
                
                const driverMarker = document.createElement('div');
                driverMarker.className = 'car-marker';
                driverMarker.style.left = `${randomX}%`;
                driverMarker.style.top = `${randomY}%`;
                driverMarker.title = 'Ø±Ø§Ù†Ù†Ø¯Ù‡ ÙØ¹Ø§Ù„';
                
                map.appendChild(driverMarker);
                driverMarkers.push(driverMarker);
            }
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù† ÙØ¹Ø§Ù„
            const activeDriversCountElement = document.getElementById('activeDriversCount');
            if (activeDriversCountElement) {
                activeDriversCountElement.textContent = activeDriversCount;
            }
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø²Ù…Ø§Ù† Ø§Ù†ØªØ¸Ø§Ø±
            const avgWaitTimeElement = document.getElementById('avgWaitTime');
            if (avgWaitTimeElement) {
                const avgWaitTime = Math.max(2, Math.floor(15 / activeDriversCount));
                avgWaitTimeElement.textContent = avgWaitTime;
            }
        }

        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø³Ø§ÙØª Ùˆ Ù‚ÛŒÙ…Øª
        function calculateDistanceAndPrice() {
            const pickupInput = document.getElementById('pickup');
            const destinationInput = document.getElementById('destination');
            const tripCalculator = document.getElementById('tripCalculator');
            
            if (!pickupInput || !destinationInput || !tripCalculator) return;
            
            const pickup = pickupInput.value;
            const destination = destinationInput.value;

            if (!pickup || !destination) {
                tripCalculator.classList.remove('active');
                return;
            }

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø³Ø§ÙØª Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
            let distance = 0;
            
            if (selectedPickup && selectedDestination) {
                // Ù…Ø­Ø§Ø³Ø¨Ù‡ ÙØ§ØµÙ„Ù‡ Ø§Ù‚Ù„ÛŒØ¯Ø³ÛŒ Ø¨ÛŒÙ† Ø¯Ùˆ Ù†Ù‚Ø·Ù‡ (Ø¯Ø± Ø­Ø§Ù„Øª ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø² Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ù…Ø³ÛŒØ±ÛŒØ§Ø¨ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯)
                const dx = selectedDestination.x - selectedPickup.x;
                const dy = selectedDestination.y - selectedPickup.y;
                distance = Math.sqrt(dx * dx + dy * dy) / 5; // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ù…Ù‚ÛŒØ§Ø³ ÙˆØ§Ù‚Ø¹ÛŒ
            } else {
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø³Ø§ÙØª
                distance = (Math.random() * 15 + 2); // Ø¨ÛŒÙ† Û² ØªØ§ Û±Û· Ú©ÛŒÙ„ÙˆÙ…ØªØ±
            }
            
            currentDistance = parseFloat(distance.toFixed(1));

            // Ù†Ù…Ø§ÛŒØ´ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ø³Ø§ÙØª
            const distanceValue = document.getElementById('distanceValue');
            if (distanceValue) distanceValue.textContent = `${currentDistance} Ú©ÛŒÙ„ÙˆÙ…ØªØ±`;
            
            tripCalculator.classList.add('active');

            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‚ÛŒÙ…Øª
            updatePrice();
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‚ÛŒÙ…Øª
        function updatePrice() {
            let basePrice = 0;
            
            switch(selectedRideType) {
                case 'economy':
                    basePrice = 50;
                    break;
                case 'comfort':
                    basePrice = 80;
                    break;
                case 'bike':
                    basePrice = 30;
                    break;
            }
            
            currentPrice = Math.round(basePrice + (currentDistance * 15));
            
            const priceValue = document.getElementById('priceValue');
            const totalPrice = document.getElementById('totalPrice');
            
            if (priceValue) priceValue.textContent = `${currentPrice} Ø§ÙØºØ§Ù†ÛŒ`;
            if (totalPrice) totalPrice.textContent = `${currentPrice} Ø§ÙØºØ§Ù†ÛŒ`;
        }

        // Ù†Ù…Ø§ÛŒØ´ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            if (!notification) return;
            
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }

        // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±
        async function checkUserLoginStatus() {
            const { data: { user } } = await supabase.auth.getUser();
            
            if (user) {
                currentUser = {
                    id: user.id,
                    phone: user.phone,
                    name: user.user_metadata?.name || 'Ú©Ø§Ø±Ø¨Ø±'
                };
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢ÙˆØ§ØªØ§Ø± Ú©Ø§Ø±Ø¨Ø±
                const userAvatar = document.getElementById('user-avatar');
                if (userAvatar) {
                    userAvatar.textContent = currentUser.name.charAt(0);
                }
                
                return true;
            } else {
                currentUser = null;
                return false;
            }
        }

        // ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±
        async function loginUser(phone, password) {
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    phone: phone,
                    password: password
                });
                
                if (error) {
                    throw error;
                }
                
                if (data.user) {
                    currentUser = {
                        id: data.user.id,
                        phone: data.user.phone,
                        name: data.user.user_metadata?.name || 'Ú©Ø§Ø±Ø¨Ø±'
                    };
                    
                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢ÙˆØ§ØªØ§Ø± Ú©Ø§Ø±Ø¨Ø±
                    const userAvatar = document.getElementById('user-avatar');
                    if (userAvatar) {
                        userAvatar.textContent = currentUser.name.charAt(0);
                    }
                    
                    showNotification('Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆØ§Ø±Ø¯ Ø´Ø¯ÛŒØ¯', 'success');
                    closeAuthModal();
                    
                    return true;
                }
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯: ' + error.message, 'error');
                return false;
            }
        }

        // Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±
        async function registerUser(phone, password, name) {
            try {
                const { data, error } = await supabase.auth.signUp({
                    phone: phone,
                    password: password,
                    options: {
                        data: {
                            name: name
                        }
                    }
                });
                
                if (error) {
                    throw error;
                }
                
                if (data.user) {
                    showNotification('Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯. Ù„Ø·ÙØ§Ù‹ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.', 'success');
                    return true;
                }
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…:', error);
                showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…: ' + error.message, 'error');
                return false;
            }
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ø³ÙØ± Ø¯Ø± Supabase
        async function saveTripToSupabase(tripData) {
            try {
                const { data, error } = await supabase
                    .from('trips')
                    .insert([tripData])
                    .select();
                
                if (error) {
                    throw error;
                }
                
                if (data && data.length > 0) {
                    return data[0].id;
                }
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø³ÙØ±:', error);
                throw error;
            }
        }

        // Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ø¯Ø§Ù„ ÙˆØ±ÙˆØ¯
        function openAuthModal() {
            const authModal = document.getElementById('authModal');
            if (authModal) {
                authModal.style.display = 'flex';
            }
        }

        // Ø¨Ø³ØªÙ† Ù…Ø¯Ø§Ù„ ÙˆØ±ÙˆØ¯
        function closeAuthModal() {
            const authModal = document.getElementById('authModal');
            if (authModal) {
                authModal.style.display = 'none';
            }
        }

        // Ø´Ø±ÙˆØ¹ Ø¬Ø³ØªØ¬ÙˆÛŒ Ø±Ø§Ù†Ù†Ø¯Ù‡
        function startDriverSearch() {
            const submitBtn = document.getElementById('submitBtn');
            if (submitBtn) submitBtn.disabled = true;
            
            showNotification('Ø¯Ø± Ø­Ø§Ù„ ÛŒØ§ÙØªÙ† Ø±Ø§Ù†Ù†Ø¯Ù‡...', 'warning');
            
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¬Ø³ØªØ¬ÙˆÛŒ Ø±Ø§Ù†Ù†Ø¯Ù‡
            setTimeout(() => {
                findDriver();
            }, 3000);
        }

        // ÛŒØ§ÙØªÙ† Ø±Ø§Ù†Ù†Ø¯Ù‡
        function findDriver() {
            // Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§ÛŒØ¯ Ø§Ø² Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ ÛŒØ§ÙØªÙ† Ø±Ø§Ù†Ù†Ø¯Ù‡ Ù†Ø²Ø¯ÛŒÚ© Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯
            const pickupLocation = selectedPickup;
            
            if (!pickupLocation) {
                showNotification('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ù…Ø¨Ø¯Ø§ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ÛŒØ§ÙØªÙ† Ø±Ø§Ù†Ù†Ø¯Ù‡
            const driver = {
                id: 1,
                name: 'Ø±Ø¶Ø§ Ø§Ø­Ù…Ø¯ÛŒ',
                rating: 'Û´.Û·',
                car_model: 'ØªÙˆÛŒÙˆØªØ§ Ú©ÙˆØ±ÙˆÙ„Ø§',
                car_color: 'Ø³ÙÛŒØ¯',
                plate_number: 'Ú©Ø§Ø¨Ù„ Û±Û²Û³Û´',
                eta: 'Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡',
                distance: 'Û±.Û² Ú©ÛŒÙ„ÙˆÙ…ØªØ±'
            };
            
            currentDriver = driver;
            
            // Ù¾Ø± Ú©Ø±Ø¯Ù† Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø±Ø§Ù†Ù†Ø¯Ù‡ Ø¯Ø± Ù…Ø¯Ø§Ù„
            const driverAvatar = document.getElementById('driverAvatar');
            const driverName = document.getElementById('driverName');
            const driverRating = document.getElementById('driverRating');
            const driverTrips = document.getElementById('driverTrips');
            const carModel = document.getElementById('carModel');
            const carColor = document.getElementById('carColor');
            const plateNumber = document.getElementById('plateNumber');
            const eta = document.getElementById('eta');
            const distance = document.getElementById('distance');
            const price = document.getElementById('price');
            
            if (driverAvatar) driverAvatar.textContent = driver.name.charAt(0);
            if (driverName) driverName.textContent = driver.name;
            if (driverRating) driverRating.textContent = driver.rating;
            if (driverTrips) driverTrips.textContent = '(Û±ÛµÛ° Ø³ÙØ±)';
            if (carModel) carModel.textContent = driver.car_model;
            if (carColor) carColor.textContent = driver.car_color;
            if (plateNumber) plateNumber.textContent = driver.plate_number;
            if (eta) eta.textContent = driver.eta;
            if (distance) distance.textContent = driver.distance;
            if (price) price.textContent = `${currentPrice} Ø§ÙØºØ§Ù†ÛŒ`;
            
            // Ù†Ù…Ø§ÛŒØ´ Ù…Ø¯Ø§Ù„
            const driverModal = document.getElementById('driverModal');
            if (driverModal) driverModal.style.display = 'flex';
            
            showNotification(`Ø±Ø§Ù†Ù†Ø¯Ù‡ ${driver.name} Ù¾ÛŒØ¯Ø§ Ø´Ø¯!`, 'success');
        }

        // Ø§Ø±Ø³Ø§Ù„ Ø§Ø¹Ù„Ø§Ù† Ø¨Ù‡ Ø±Ø§Ù†Ù†Ø¯Ù‡
        function sendDriverNotification(tripData) {
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø§Ø¹Ù„Ø§Ù† Ø¨Ù‡ Ø±Ø§Ù†Ù†Ø¯Ú¯Ø§Ù† Ù†Ø²Ø¯ÛŒÚ©
            const drivers = [
                { id: 1, name: 'Ø±Ø¶Ø§ Ø§Ø­Ù…Ø¯ÛŒ', status: 'active' },
                { id: 2, name: 'Ø¹Ù„ÛŒ Ú©Ø±ÛŒÙ…ÛŒ', status: 'active' },
                { id: 3, name: 'Ø­Ø³ÛŒÙ† Ù…Ø­Ù…Ø¯ÛŒ', status: 'active' }
            ];
            
            if (drivers.length === 0) {
                showNotification('Ù‡ÛŒÚ† Ø±Ø§Ù†Ù†Ø¯Ù‡â€ŒØ§ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª', 'error');
                return;
            }
            
            // Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ø§Ù†Ù†Ø¯Ù‡ ØªØµØ§Ø¯ÙÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ù„Ø§Ù†
            const randomDriver = drivers[Math.floor(Math.random() * drivers.length)];
            
            // Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ù„Ø§Ù† Ø¨Ù‡ Ø±Ø§Ù†Ù†Ø¯Ù‡ (Ø¯Ø± Ø­Ø§Ù„Øª ÙˆØ§Ù‚Ø¹ÛŒ Ø§ÛŒÙ† Ø§Ø¹Ù„Ø§Ù† Ø¨Ù‡ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø±Ø§Ù†Ù†Ø¯Ù‡ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯)
            showDriverNotification(tripData, randomDriver);
            
            // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
            showNotification(`Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ù…Ø§ Ø¨Ù‡ ${randomDriver.name} Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯`, 'success');
        }

        // Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ù„Ø§Ù† Ø¨Ù‡ Ø±Ø§Ù†Ù†Ø¯Ù‡
        function showDriverNotification(tripData, driver) {
            const notification = document.getElementById('driverNotification');
            const notificationPickup = document.getElementById('notificationPickup');
            const notificationDestination = document.getElementById('notificationDestination');
            const notificationPrice = document.getElementById('notificationPrice');
            
            if (!notification || !notificationPickup || !notificationDestination || !notificationPrice) return;
            
            // Ù¾Ø± Ú©Ø±Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø¹Ù„Ø§Ù†
            notificationPickup.textContent = tripData.pickup;
            notificationDestination.textContent = tripData.destination;
            notificationPrice.textContent = tripData.price;
            
            // Ù†Ù…Ø§ÛŒØ´ Ø§Ø¹Ù„Ø§Ù†
            notification.classList.add('active');
            
            // ØªÙ†Ø¸ÛŒÙ… timeout Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù† Ø§Ø¹Ù„Ø§Ù†
            setTimeout(() => {
                if (notification.classList.contains('active')) {
                    notification.classList.remove('active');
                    // Ø¯Ø± Ø­Ø§Ù„Øª ÙˆØ§Ù‚Ø¹ÛŒØŒ Ø§Ú¯Ø± Ø±Ø§Ù†Ù†Ø¯Ù‡ Ù¾Ø§Ø³Ø® Ù†Ø¯Ù‡Ø¯ØŒ Ø¨Ù‡ Ø±Ø§Ù†Ù†Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
                    showNotification('Ø±Ø§Ù†Ù†Ø¯Ù‡ Ù¾Ø§Ø³Ø® Ù†Ø¯Ø§Ø¯. Ø¯Ø± Ø­Ø§Ù„ ÛŒØ§ÙØªÙ† Ø±Ø§Ù†Ù†Ø¯Ù‡ Ø¯ÛŒÚ¯Ø±...', 'warning');
                    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ÛŒØ§ÙØªÙ† Ø±Ø§Ù†Ù†Ø¯Ù‡ Ø¯ÛŒÚ¯Ø±
                    setTimeout(findDriver, 2000);
                }
            }, 15000); // 15 Ø«Ø§Ù†ÛŒÙ‡ timeout
        }

        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡
        window.onload = function() {
            createInteractiveMap();
            checkUserLoginStatus();
            
            // Ø¯Ú©Ù…Ù‡ Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡
            const startAppBtn = document.getElementById('start-app-btn');
            if (startAppBtn) {
                startAppBtn.addEventListener('click', () => {
                    const welcomePage = document.getElementById('welcome-page');
                    const mainHeader = document.getElementById('main-header');
                    const mainContainer = document.getElementById('main-container');
                    const mainFooter = document.getElementById('main-footer');
                    
                    if (welcomePage) welcomePage.style.display = 'none';
                    if (mainHeader) mainHeader.style.display = 'block';
                    if (mainContainer) mainContainer.style.display = 'block';
                    if (mainFooter) mainFooter.style.display = 'block';
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±
                    if (!currentUser) {
                        openAuthModal();
                    }
                });
            }
            
            // Ø¯Ú©Ù…Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÛŒØ§Ø¨ÛŒ
            const locateMeBtn = document.getElementById('locateMeBtn');
            if (locateMeBtn) {
                locateMeBtn.addEventListener('click', locateUser);
            }
            
            // Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ù†Ù‚Ø´Ù‡
            const resetMapBtn = document.getElementById('resetMapBtn');
            if (resetMapBtn) {
                resetMapBtn.addEventListener('click', () => {
                    // Ø­Ø°Ù Ù‡Ù…Ù‡ Ù†Ø´Ø§Ù†Ú¯Ø±Ù‡Ø§
                    if (pickupMarker) {
                        pickupMarker.remove();
                        pickupMarker = null;
                    }
                    if (destinationMarker) {
                        destinationMarker.remove();
                        destinationMarker = null;
                    }
                    if (routeLine) {
                        routeLine.remove();
                        routeLine = null;
                    }
                    
                    // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§
                    const pickupInput = document.getElementById('pickup');
                    const destinationInput = document.getElementById('destination');
                    if (pickupInput) pickupInput.value = '';
                    if (destinationInput) destinationInput.value = '';
                    
                    // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø­Ø§Ù„Øª
                    selectedPickup = null;
                    selectedDestination = null;
                    mapMode = 'pickup';
                    
                    // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù…Ø§Ø´ÛŒÙ†â€ŒØ­Ø³Ø§Ø¨
                    const tripCalculator = document.getElementById('tripCalculator');
                    if (tripCalculator) tripCalculator.classList.remove('active');
                    
                    showNotification('Ù†Ù‚Ø´Ù‡ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯', 'success');
                });
            }
            
            // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯Ù†Ù…Ø§ÛŒÛŒ Ùˆ Ú©ÙˆÚ†Ú©Ù†Ù…Ø§ÛŒÛŒ (Ù†Ù…Ø§Ø¯ÛŒÙ†)
            const zoomInBtn = document.getElementById('zoomInBtn');
            const zoomOutBtn = document.getElementById('zoomOutBtn');
            
            if (zoomInBtn) {
                zoomInBtn.addEventListener('click', () => {
                    showNotification('Ø¨Ø²Ø±Ú¯Ù†Ù…Ø§ÛŒÛŒ Ù†Ù‚Ø´Ù‡', 'warning');
                });
            }
            
            if (zoomOutBtn) {
                zoomOutBtn.addEventListener('click', () => {
                    showNotification('Ú©ÙˆÚ†Ú©Ù†Ù…Ø§ÛŒÛŒ Ù†Ù‚Ø´Ù‡', 'warning');
                });
            }
            
            // Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¹Ù„Ø§Ù† Ø±Ø§Ù†Ù†Ø¯Ù‡
            const closeDriverNotification = document.getElementById('closeDriverNotification');
            const rejectTripBtn = document.getElementById('rejectTripBtn');
            const acceptTripBtn = document.getElementById('acceptTripBtn');
            const driverNotification = document.getElementById('driverNotification');
            
            if (closeDriverNotification) {
                closeDriverNotification.addEventListener('click', () => {
                    if (driverNotification) driverNotification.classList.remove('active');
                });
            }
            
            if (rejectTripBtn) {
                rejectTripBtn.addEventListener('click', () => {
                    if (driverNotification) driverNotification.classList.remove('active');
                    showNotification('Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø³ÙØ± Ø±Ø¯ Ø´Ø¯', 'warning');
                    // Ø¯Ø± Ø­Ø§Ù„Øª ÙˆØ§Ù‚Ø¹ÛŒØŒ Ø§ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ Ø±Ø§Ù†Ù†Ø¯Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
                });
            }
            
            if (acceptTripBtn) {
                acceptTripBtn.addEventListener('click', () => {
                    if (driverNotification) driverNotification.classList.remove('active');
                    showNotification('Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø³ÙØ± Ù¾Ø°ÛŒØ±ÙØªÙ‡ Ø´Ø¯', 'success');
                    // Ø¯Ø± Ø­Ø§Ù„Øª ÙˆØ§Ù‚Ø¹ÛŒØŒ Ø§ÛŒÙ†Ø¬Ø§ Ø±Ø§Ù†Ù†Ø¯Ù‡ Ø³ÙØ± Ø±Ø§ Ù…ÛŒâ€ŒÙ¾Ø°ÛŒØ±Ø¯
                });
            }
            
            // Ø§Ù†ØªØ®Ø§Ø¨ Ù†ÙˆØ¹ Ø³ÙØ±
            const rideOptions = document.querySelectorAll('.ride-option');
            rideOptions.forEach(option => {
                option.addEventListener('click', () => {
                    // Ø­Ø°Ù Ú©Ù„Ø§Ø³ active Ø§Ø² Ù‡Ù…Ù‡ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§
                    rideOptions.forEach(opt => opt.classList.remove('active'));
                    
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ù„Ø§Ø³ active Ø¨Ù‡ Ú¯Ø²ÛŒÙ†Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
                    option.classList.add('active');
                    
                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†ÙˆØ¹ Ø³ÙØ± Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
                    selectedRideType = option.getAttribute('data-type');
                    
                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‚ÛŒÙ…Øª
                    if (currentDistance > 0) {
                        updatePrice();
                    }
                });
            });
            
            // ÙØ±Ù… Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø³ÙØ±
            const rideForm = document.getElementById('rideForm');
            if (rideForm) {
                rideForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    if (!currentUser) {
                        showNotification('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯ Ø´ÙˆÛŒØ¯', 'error');
                        openAuthModal();
                        return;
                    }
                    
                    const pickupInput = document.getElementById('pickup');
                    const destinationInput = document.getElementById('destination');
                    
                    const pickup = pickupInput?.value;
                    const destination = destinationInput?.value;

                    if (!pickup || !destination) {
                        showNotification('Ù„Ø·ÙØ§Ù‹ Ù…Ø¨Ø¯Ø§ Ùˆ Ù…Ù‚ØµØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                        return;
                    }

                    if (pickup === destination) {
                        showNotification('Ù…Ø¨Ø¯Ø§ Ùˆ Ù…Ù‚ØµØ¯ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ ÛŒÚ©Ø³Ø§Ù† Ø¨Ø§Ø´Ù†Ø¯', 'error');
                        return;
                    }

                    if (currentDistance === 0) {
                        showNotification('Ù„Ø·ÙØ§Ù‹ Ù…Ù†ØªØ¸Ø± Ø¨Ù…Ø§Ù†ÛŒØ¯ ØªØ§ Ù…Ø³Ø§ÙØª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´ÙˆØ¯', 'error');
                        return;
                    }

                    // Ø°Ø®ÛŒØ±Ù‡ Ø³ÙØ± Ø¯Ø± Supabase
                    const tripData = {
                        user_id: currentUser.id,
                        pickup,
                        destination,
                        ride_type: selectedRideType,
                        distance: currentDistance,
                        price: currentPrice,
                        status: 'requested',
                        pickup_location: selectedPickup,
                        destination_location: selectedDestination,
                        created_at: new Date().toISOString()
                    };

                    try {
                        const tripId = await saveTripToSupabase(tripData);
                        currentTripId = tripId;

                        showNotification('Ø³ÙØ± Ø´Ù…Ø§ Ø«Ø¨Øª Ø´Ø¯. Ø¯Ø± Ø­Ø§Ù„ ÛŒØ§ÙØªÙ† Ø±Ø§Ù†Ù†Ø¯Ù‡...', 'success');

                        // Ø§Ø±Ø³Ø§Ù„ Ø§Ø¹Ù„Ø§Ù† Ø¨Ù‡ Ø±Ø§Ù†Ù†Ø¯Ù‡
                        sendDriverNotification(tripData);
                        
                        // Ø´Ø±ÙˆØ¹ Ø¬Ø³ØªØ¬Ùˆ
                        startDriverSearch();
                    } catch (error) {
                        console.error('Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ø³ÙØ±:', error);
                        showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ø³ÙØ±. Ù„Ø·ÙØ§Ù‹ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.', 'error');
                    }
                });
            }
            
            // ÙØ±Ù… ÙˆØ±ÙˆØ¯
            const authForm = document.getElementById('authForm');
            if (authForm) {
                authForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const phone = document.getElementById('phone').value;
                    const password = document.getElementById('password').value;
                    
                    if (!phone || !password) {
                        showNotification('Ù„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error');
                        return;
                    }
                    
                    const success = await loginUser(phone, password);
                    
                    if (success) {
                        closeAuthModal();
                    }
                });
            }
            
            // Ø¨Ø³ØªÙ† Ù…Ø¯Ø§Ù„â€ŒÙ‡Ø§
            const closeAuthModalBtn = document.getElementById('closeAuthModal');
            if (closeAuthModalBtn) {
                closeAuthModalBtn.addEventListener('click', closeAuthModal);
            }
            
            const closeDriverModalBtn = document.getElementById('closeDriverModal');
            if (closeDriverModalBtn) {
                closeDriverModalBtn.addEventListener('click', () => {
                    const driverModal = document.getElementById('driverModal');
                    if (driverModal) {
                        driverModal.style.display = 'none';
                    }
                });
            }
            
            // ØªØ£ÛŒÛŒØ¯ Ø³ÙØ±
            const confirmTripBtn = document.getElementById('confirmTripBtn');
            if (confirmTripBtn) {
                confirmTripBtn.addEventListener('click', () => {
                    const driverModal = document.getElementById('driverModal');
                    if (driverModal) {
                        driverModal.style.display = 'none';
                    }
                    
                    showNotification('Ø³ÙØ± Ø´Ù…Ø§ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯. Ø±Ø§Ù†Ù†Ø¯Ù‡ Ø¯Ø± Ø±Ø§Ù‡ Ø§Ø³Øª.', 'success');
                    
                    // Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø±Ø¯ÛŒØ§Ø¨ÛŒ Ø³ÙØ± Ø±Ø§ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯
                });
            }
            
            // Ú©Ù„ÛŒÚ© Ø®Ø§Ø±Ø¬ Ø§Ø² Ù…Ø¯Ø§Ù„ Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ø¢Ù†
            window.addEventListener('click', (e) => {
                const authModal = document.getElementById('authModal');
                const driverModal = document.getElementById('driverModal');
                
                if (authModal && e.target === authModal) {
                    closeAuthModal();
                }
                
                if (driverModal && e.target === driverModal) {
                    driverModal.style.display = 'none';
                }
            });
        };
    </script>
</body>
</html>
